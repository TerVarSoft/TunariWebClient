"use strict";angular.module("tunariApp",["ngAnimate","ngRoute","restangular","cgNotify","ngMaterial","ngMdIcons","ngMessages","ui.materialize"]).config(["$routeProvider","$mdThemingProvider","$httpProvider","RestangularProvider","Config",function(a,b,c,d,e){b.theme("default").primaryPalette("blue-grey").accentPalette("pink"),b.enableBrowserColor({hue:"500"}),d.setBaseUrl(e.tunariApi+"/api"),d.addResponseInterceptor(function(a,b,c,d,e,f){var g;return"getList"===b?(g=a.data.items,g.meta=a.data.meta):g=a.data,g}),d.setRestangularFields({id:"_id"}),moment.locale("es",{months:"Enero_Febrero_Marzo_Abril_Mayo_Junio_Julio_Agosto_Septiembre_Octubre_Noviembre_Diciembre".split("_"),weekdays:"Domingo_Lunes_Martes_Miercoles_Jueves_Viernes_Sabado".split("_")}),a.when("/",{templateUrl:"views/products.html",controller:"ProductsCtrl",controllerAs:"Products"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"login"}).when("/logout",{controller:"LogoutCtrl",templateUrl:"views/empty.html",controllerAs:"logout"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl",controllerAs:"register"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/shoppingTabs",{templateUrl:"views/shoppingTabs.html",controller:"ShopCtrl",controllerAs:"ProductSearcher"}).when("/products",{templateUrl:"views/products.html",controller:"ProductsCtrl",controllerAs:"Products"}).when("/products/:productId",{templateUrl:"views/newProduct.html",controller:"NewProductCtrl",controllerAs:"editProduct"}).when("/newProduct",{templateUrl:"views/newProduct.html",controller:"NewProductCtrl",controllerAs:"newProduct"}).when("/clientSearch",{templateUrl:"views/clientSearch.html",controller:"ClientSearchCtrl",controllerAs:"clientSearch"}).when("/clientSamples/:clientId",{templateUrl:"views/clientSamples.html",controller:"ClientSamplesCtrl",controllerAs:"clientSamples"}).when("/newClient",{templateUrl:"views/newClient.html",controller:"NewClientCtrl",controllerAs:"newClient"}).when("/clients/:clientId",{templateUrl:"views/editClient.html",controller:"EditClientCtrl",controllerAs:"editClient"}).when("/statistics",{templateUrl:"views/statistics.html",controller:"StatisticsCtrl",controllerAs:"statistics"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl",controllerAs:"settings"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","AuthToken",function(a,b,c){a.$on("$routeChangeStart",function(a,d){c.isAuthenticated()||"views/login.html"==d.templateUrl||(console.log("No token in local storage!, Then not authenticated, redirect to Login!"),a.preventDefault(),b.path("/login"))})}]),angular.module("tunariApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("tunariApp").controller("AddquantityCtrl",["$scope","$mdDialog","product",function(a,b,c){a.product=c,a.cancel=function(){b.cancel()},a.add=function(){c.quantityToSell=a.quantity,b.hide()}}]),angular.module("tunariApp").controller("AddingProductCtrl",["$scope","$uibModalInstance","productName","Messages",function(a,b,c,d){a.productName=c,a.messages=d,a.accept=function(){b.close(a.quantityToAdd)},a.cancel=function(){b.dismiss()}}]),angular.module("tunariApp").controller("SellingOptionsCtrl",["$scope","$mdBottomSheet",function(a,b){a.items=[{name:"ResetProductQuantities",text:"Resetear cantidades",icon:"settings_backup_restore"},{name:"CleanShoppingCart",text:"Limpiar el carrito",icon:"delete"}],a.listItemClick=function(c){var d=a.items[c];b.hide(d)}}]),angular.module("tunariApp").controller("ClientSamplesCtrl",["Clients","Products","ServerData","$scope","$location","$routeParams",function(a,b,c,d,e,f){d.serverData=c,c.config.get().then(function(a){d.invitationTypes=a.invitationTypes,d.selectedType=d.invitationTypes[0]}),d.distributedOptions=["Todos","Repartidos","No Repartidos"],d.distributedOption=d.distributedOptions[0],d.client={},a.one(f.clientId).get().then(function(a){d.client=a,d.savedProductSamples=_.clone(a.productSamples),d.getInvitations()}),d.getInvitations=function(){d.isAllMarked=!1,d.client.productSamples[d.selectedType]||(d.client.productSamples[d.selectedType]=[]);var a={category:"Invitaciones","properties.type":d.selectedType||"Mementos"};b.getList(a).then(function(a){d.products=a,_.each(d.products,function(a){a.isDistributed=_.includes(d.client.productSamples[d.selectedType],a.name)})})},d.filterDistributedOptions=function(a){var b=!0;return"Repartidos"==d.distributedOption?b=a.isDistributed:"No Repartidos"==d.distributedOption&&(b=!a.isDistributed),b},d.addSample=function(a){_.includes(d.client.productSamples[d.selectedType],a.name)?(d.client.productSamples[d.selectedType]=_.without(d.client.productSamples[d.selectedType],a.name),a.isDistributed=!1):(d.client.productSamples[d.selectedType].push(a.name),a.isDistributed=!0)},d.saveModification=function(){d.client.save().then(function(){e.path("/clientSearch")})},d.cancelModifications=function(){d.client.productSamples=_.clone(d.savedProductSamples),e.path("/clientSearch")},d.toogleMark=function(){d.products.length<=0||(d.isAllMarked?(d.client.productSamples[d.selectedType]=[],d.isAllMarked=!1):(d.isAllMarked=!0,d.client.productSamples[d.selectedType]=_.pluck(d.products,"name")),_.each(d.products,function(a){a.isDistributed=d.isAllMarked}))}}]),angular.module("tunariApp").controller("ClientSearchCtrl",["$scope","$location","Clients",function(a,b,c){a.header.title="Clientes",c.getList().then(function(b){a.clients=b,a.pagination={},a.pagination.pageSize=10,a.pagination.numberOfPages=Math.ceil(a.clients.length/a.pagination.pageSize)}),a.search=function(){c.getList({name:a.selectedClient.name}).then(function(b){a.clients=b})},a.editClient=function(a){b.path("/clients/"+a)},a.showProductSamples=function(a){b.path("/clientSamples/"+a)},a.windowTop=function(){window.scrollTo(0,0)}}]),angular.module("tunariApp").controller("ContentCtrl",["$scope","$mdSidenav","$mdToast","SpeechRecognition",function(a,b,c,d){function e(){a.isRecording&&(a.layout.title=d.getTranscript(),a.$apply())}function f(b){a.isRecording&&(a.isRecording=!1,a.layout.recordIcon="mic",a.$broadcast("onFinalResultFromSpeechRecognizer",{finalSearchText:b}))}a.layout={title:"Producciones Tunari",backupTitle:"Producciones Tunari",bottomFabButtonIcon:"add",bottomFabButtonIconTooltip:"Oprimeme!",recordIcon:"mic",hideHeader:!0},a.isRecording=!1,a.toggleSidenav=function(a){b(a).toggle()},a.closeSideNav=function(a){b(a).close()},a.bottomFabRightButtonClick=function(b){a.$broadcast("onBottomFabRightButtonClicked",{ev:b})},a.bottomFabLeftButtonClick=function(){a.$broadcast("onBottomFabLeftButtonClicked",{})},a.showToast=function(a,b){c.show(c.simple().textContent(a).action(b).highlightAction(!0).position("right").hideDelay(4e3).parent(angular.element(document.body)))},a.toogleRecording=function(){if(a.isRecording=!a.isRecording,a.isRecording)try{d.startRecognition(),a.layout.recordIcon="mic_off"}catch(b){a.layout.recordIcon="mic",a.showToast("No pude oir!, prueba otra vez",":)")}else a.layout.recordIcon="mic",d.stopRecognition(),a.$broadcast("onFinalResultFromSpeechRecognizer",{finalSearchText:d.getTranscript()})},d.registirObserverOnResultCallback(e),d.registirObserverOnFinalResultCallback(f)}]),angular.module("tunariApp").controller("EditClientCtrl",["$scope","$location","$routeParams","$uibModal","Clients","Notifier","Messages",function(a,b,c,d,e,f,g){e.one(c.clientId).get().then(function(b){a.client=b,a.savedClient=$.extend(!0,{},a.client)}),a.saveClient=function(){a.client.save().then(function(){b.path("/clientSearch"),f({message:g.message003+a.client.name,classes:"alert-info"})})},a.cancelEditClient=function(){a.client=$.extend(!0,{},a.savedClient),b.path("/clientSearch")},a.deleteClient=function(){var h=d.open({templateUrl:"../../views/questionModal.html",controller:"QuestionModalCtrl",resolve:{options:function(){return{title:g.message008,message:g.message009+a.client.name+"?"}}}});h.result.then(function(){e.one(c.clientId).remove().then(function(){b.path("/clientSearch"),f({message:g.message005+a.client.name,classes:"alert-danger"})})})}}]),angular.module("tunariApp").controller("EditProductCtrl",["$scope","$location","$routeParams","$uibModal","Products","ServerData","Notifier","Messages",function(a,b,c,d,e,f,g,h){a.serverData=f,a.product=e.one(c.productId).get().then(function(b){a.product=b,a.tagsToRemoveWhenUpdating=i(),f.config.get().then(function(b){a.config=b,a.productView=_.where(b.productCategories,{name:a.product.category})[0].view})});var i=function(){var b=[a.product.name,a.product.provider];return b};a.saveProduct=function(){j(),a.product.put().then(function(){b.path("/productSearch"),g({message:h.message004+a.product.name,classes:"alert-info"})},function(b){g((b.code=409)?{message:_.template(h.message018)({product:a.product.name}),classes:"alert-danger"}:{message:h.message019,classes:"alert-danger"})})};var j=function(){a.product.sortTag=a.product.category+a.product.name,a.product.tags=_.difference(a.product.tags,a.tagsToRemoveWhenUpdating),a.product.tags.push(a.product.name),a.product.tags.push(a.product.provider),a.$broadcast("prepareSpecificPropertiesBeforeProductSaving")};a.cancelEditing=function(){b.path("/productSearch")},a.deleteProduct=function(){var f=d.open({templateUrl:"../../views/questionModal.html",controller:"QuestionModalCtrl",resolve:{options:function(){return{title:h.message010,message:h.message011+a.product.name+"?"}}}});f.result.then(function(){e.one(c.productId).remove().then(function(){b.path("/productSearch"),g({message:h.message006+a.product.name,classes:"alert-danger"})})})}}]),angular.module("tunariApp").controller("InvitationDetailsCtrl",["$scope","Settings",function(a,b){function c(){var b=a.$parent.product.name.split("-"),c=_.last(b),d=/^\d+$/.test(c),e="";return d&&(e=c),e}b.getList().then(function(b){a.invitationTypes=_.find(b,{key:"invitationTypes"}).value,a.$parent.product.properties.type=a.$parent.product.properties.type?a.$parent.product.properties.type:a.invitationTypes[0],a.invitationsDetailsConfig=_.find(b,{key:"invitationsDetails"}).value,a.updatePropertiesOptions()}),a.updatePropertiesOptions=function(){var b=_.cloneDeep(a.invitationsDetailsConfig);a.invitationDetails=b.Default;var c=a.$parent.product.properties.type;_.mergeWith(a.invitationDetails,b[c]||{},function(a,b){if(_.isArray(a))return b}),a.invitationSizes=a.invitationDetails.sizes,a.invitationGenres=a.invitationDetails.genres},a.$on("prepareSpecificPropertiesBeforeProductSaving",function(b){a.$parent.product.tags=_.difference(a.$parent.product.tags,_.intersection(a.$parent.product.tags,a.invitationTypes)),a.$parent.product.tags=_.difference(a.$parent.product.tags,_.intersection(a.$parent.product.tags,a.invitationSizes)),a.$parent.product.tags=_.difference(a.$parent.product.tags,_.intersection(a.$parent.product.tags,a.invitationGenres)),a.$parent.product.tags.push(a.$parent.product.properties.type),a.$parent.product.tags.push(a.$parent.product.properties.size),a.$parent.product.tags.push(a.$parent.product.properties.genre);var d=c();a.$parent.product.sortTag=a.$parent.product.properties.type+d})}]),angular.module("tunariApp").controller("InvitationsQuantityChartsCtrl",["$scope","Settings","Products",function(a,b,c){var d=8;b.getList().then(function(b){a.invitationTypes=_.find(b,{key:"invitationTypes"}).value;var e=["#4089A1","#7DAB6D","#AB7A6A","#C5CC7A","#82698C","#7C8087","#8DC9C6","#DB5353"];a.mappedColors=_.zipObject(a.invitationTypes,e),console.log(_.zip(a.invitationTypes,e)),a.chartsData={},_.each(a.invitationTypes,function(b){c.getList({category:"Invitaciones",maxQuantity:9e3,"properties.type":b,querySort:"quantity",queryLimit:d}).then(function(c){a.chartsData[b]=_.map(c,function(a){return a})})})})}]),angular.module("tunariApp").controller("LoginCtrl",["$scope","$location","Login","AuthToken",function(a,b,c,d){a.layout.title="Login",a.layout.hideHeader=!0,a.loginUser=function(){var e={userName:a.userName,password:a.password};c.post(e).then(function(a){d.setUserToken(a),b.path("/")},function(b){401==b.status&&a.showToast("Credenciales Invalidas","Problemas!")})}}]),angular.module("tunariApp").controller("LogoutCtrl",["$location","AuthToken",function(a,b){b.removeUserToken(),a.path("/login")}]),angular.module("tunariApp").controller("MainCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("tunariApp").controller("ImageCtrl",["$scope","$mdDialog","$mdMedia","ServerData","product",function(a,b,c,d,e){a.product=e,a.getImageUrl=function(){var b=c("sm")||c("xs"),e=d.urlImages+"/"+a.product.category+"/"+(a.product.properties.type||"")+"/"+a.product.name;return b?e+"-M.jpg":e+"-L.jpg"},a.cancel=function(){b.cancel()}}]),angular.module("tunariApp").controller("ProductQuickSearchCtrl",["$scope","$mdDialog","ProductInfo",function(a,b,c){a.tags=c.getProductQuickSearchs(),a.selectTag=function(a){b.hide(a)}}]),angular.module("tunariApp").controller("ProductsViewSettingsCtrl",["$scope","$mdDialog","Settings","ProductInfo",function(a,b,c,d){a.selectedPriceType=d.getSelectedPriceType(),a.priceTypes=d.getPriceTypes(),a.saveSettings=function(){b.hide(a.selectedPriceType)}}]),angular.module("tunariApp").controller("summaryCartCtrl",["$scope","$mdDialog","Clients","sellingItems","sellClient",function(a,b,c,d,e){function f(a){var b=angular.lowercase(a);return function(a){return 0===a.name.indexOf(b)}}a.sellingItems=d,a.selectedClient=e,c.getList().then(function(b){a.clients=b}),a.cancel=function(){b.cancel(a.selectedClient)},a.getTotal=function(){var b=_.sum(a.sellingItems,function(a){return a.total});return _.round(b,2)},a.sell=function(){b.hide(a.getTotal())},a.queryClientSearch=function(b){var c=b?a.clients.filter(f(b)):a.clients;return c}}]),angular.module("tunariApp").controller("NavBarCtrl",["$scope","$location","$mdSidenav","AuthToken",function(a,b,c,d){a.isUserAuthenticated=d.isAuthenticated,a.getUserName=d.getUserFullName,a.menus={products:{icon:"store",redirectTo:"/products",propName:"products",text:"Productos"},statistics:{icon:"insert_chart",redirectTo:"/statistics",propName:"statistics",text:"Estadisticas"},settings:{icon:"settings",redirectTo:"/settings",propName:"settings",text:"Configuraciones"},register:{icon:"person_add",redirectTo:"/register",propName:"register",text:"Registrar usuario"},logout:{icon:"logout",redirectTo:"/logout",propName:"logout",text:"Salir"}},a.changeView=function(d){a.subMenu=a.menus[d].subMenuView||"",b.path(a.menus[d].redirectTo),c("sideNav").toggle()},$("#js-navbar-collapse a").on("click",function(){$("#js-navbar-collapse").collapse("hide")}),$(".nav a").on("click",function(){$(".nav").find(".active").removeClass("active"),$(this).parent().addClass("active")})}]),angular.module("tunariApp").controller("NewClientCtrl",["$scope","$location","Clients","Notifier","Messages","ServerData",function(a,b,c,d,e,f){a.createClient=function(){a.newClient.productSamples={},f.config.get().then(function(f){var g=f.invitationTypes;_.each(g,function(b){a.newClient.productSamples[b]=[]}),c.post(a.newClient).then(function(){b.path("/clientSearch"),d({message:e.message001+a.newClient.name,classes:"alert-success"})})}),$(".nav").find(".active").removeClass("active")},a.cancelNewClient=function(){b.path("/clientSearch"),$(".nav").find(".active").removeClass("active")},$("#name").focus()}]),angular.module("tunariApp").controller("NewProductCtrl",["$scope","$location","$routeParams","$mdDialog","AuthRestangular","Settings","ProductInfo","Products","Notifier","Messages",function(a,b,c,d,e,f,g,h,i,j){function k(){a.product.name=_.toUpper(a.product.name),a.product.sortTag=a.product.category+a.product.name,a.product.tags=_.difference(a.product.tags,_.intersection(a.product.tags,_.map(a.categories,"name"))),a.product.tags=_.difference(a.product.tags,_.intersection(a.product.tags,a.productProviders)),_.pull(a.product.tags,a.originalName),a.product.tags.push(a.product.name),a.product.tags.push(a.product.category),a.product.tags.push(a.product.provider),a.$broadcast("prepareSpecificPropertiesBeforeProductSaving"),a.product.tags=_.filter(a.product.tags,function(a){return!_.isEmpty(a)})}function l(){a.product.category=a.product.category?a.product.category:a.categories[0].name,a.product.prices=a.product.prices||[],a.product.locations=a.product.locations||[],a.product.tags=a.product.tags?a.product.tags:[],a.product.images=a.product.images||[],a.product.properties=a.product.properties?a.product.properties:{}}function m(b){var c=b.config.data.name;409===b.status?(a.showToast(_.template(j.message018)({product:c}),c),console.log(_.template(j.message018)({product:c}))):console.log(j.message019)}a.layout.title="Nuevo Producto",a.layout.hideHeader=!1,a.productNames=[],a.newPrice={},a.newLocation={},a.product=e.one("products"),a.isLoading=!0,f.getList().then(function(b){a.categories=_.find(b,{key:"productCategories"}).value,a.productProviders=_.find(b,{key:"productProviders"}).value,a.priceTypes=_.find(b,{key:"priceTypes"}).value,a.newPrice.type=_.find(a.priceTypes,function(a){return _.includes(a,"Unidad")}),a.newPrice.quantity=1,a.locationTypes=_.find(b,{key:"locationTypes"}).value,a.newLocation.type=a.locationTypes[0],c.productId?h.one(c.productId).get().then(function(b){a.product=b,a.originalName=a.product.name,a.layout.title="Editar Producto "+a.product.name,l(),a.updateView(),a.isLoading=!1}):(l(),a.updateView(),a.isLoading=!1)}),a.updateView=function(){a.specificPropertiesView=_.find(a.categories,{name:a.product.category}).view},a.selectPriceType=function(){_.includes(a.newPrice.type,"Paquete")?(a.isNewPriceQuantityShowed=!0,a.newPrice.quantity=100):"Otro"===a.newPrice.type?(a.isPriceTypeInputShowed=!0,a.isNewPriceQuantityShowed=!0,a.newPrice.quantity=100):(a.isNewPriceQuantityShowed=!1,a.newPrice.quantity=1)},a.addPrice=function(){a.isPriceTypeInputShowed=!1,a.product.prices.splice(0,0,a.newPrice),a.newPrice={}},a.removePrice=function(b){_.pull(a.product.prices,b)},a.addLocation=function(){a.product.locations.splice(0,0,a.newLocation),a.newLocation={}},a.removeLocation=function(b){_.pull(a.product.locations,b)},a.getProductImageUrl=function(a,b){return g.getProductImageUrl(a,b)},a.getExtraImageUrl=function(a){return g.getExtraImageUrl(a)},a.save=function(){k(),a.product.save().then(function(c){a.showToast("Bien! Haz salvado el producto",c.name),b.path("/products")},function(a){m(a)})},a.saveAndNew=function(){k(),a.product.save().then(function(c){a.showToast("Bien! Haz salvado el producto",c.name),a.product=e.one("products"),b.path("/newProduct")},function(a){m(a)})},a.cancel=function(){b.path("/products")}}]),angular.module("tunariApp").controller("ProductsCtrl",["$scope","$location","$timeout","$mdDialog","$mdMedia","AuthRestangular","Config","Messages","Products","ProductInfo","SearchInfo",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){b.isFavorite=!0,b.put().then(function(){a.favorites.push(b),c(function(){var a=$(".carousel");a.removeClass("initialized"),a.carousel()},200)})}function m(b){b.isFavorite=!1,b.put().then(function(){_.remove(a.favorites,{_id:b._id}),c(function(){var a=$(".carousel");a.removeClass("initialized"),a.carousel()},200)})}function n(a){401==a.status&&(console.log("Invalid jwt in local storage!, then redirecting to login"),b.path("/login"))}a.layout.title="Productos",a.layout.hideHeader=!1;var o={page:0,itemsPerPage:30};e("xs");a.searchTags=[],a.products=[],a.favorites=[],a.showFavorites=!1,a.selectedPriceType=j.getSelectedPriceType()||"Paquete",i.getList({isFavorite:!0}).then(function(b){a.favorites=b,a.showFavorites=!0},n),a.search=function(){a.products=[],o.page=0,_.isEmpty(a.searchTags)?a.showFavorites=!0:a.showFavorites=!1,a.searchMore()},a.searchMore=function(){a.isLoading=!0;var b=_.isEmpty(a.searchTags)?{}:{tags:a.searchTags.join(" ")};b.page=++o.page,b.queryLimit=o.itemsPerPage,i.getList(b).then(function(b){a.products=_.concat(a.products,b),a.showToast(b.meta.count+" Productos encontrados!","TUNARI"),k.setTags(a.searchTags),a.isLoading=!1},n)},a.getProductImageUrl=function(a,b){return j.getProductImageUrl(a,b)},a.hasPriceToShow=function(b){return _.some(b.prices,{type:a.selectedPriceType})},a.openCreateProductModal=function(a){b.path("newProduct")},a.openEditProductModal=function(a,c){b.path("products/"+c._id)},a.openQuickSearchsModal=function(b){d.show({controller:"ProductQuickSearchCtrl",templateUrl:"../../views/modal/productQuickSearch.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0}).then(function(b){a.searchTags=[b],a.search()},function(){})},a.openProductsSettings=function(b){d.show({controller:"ProductsViewSettingsCtrl",templateUrl:"../../views/modal/productsViewSettings.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0}).then(function(b){j.setSelectedPriceType(b),a.selectedPriceType=b},function(){})},a.openReduceQuantity=function(b,c){c.quantity?"Existen "+c.quantity+" Unidades actualmente en el deposito.":"No sabemos cuantas unidades hay de este producto :(";if(c.quantity){var e=d.prompt().title("Venta del producto "+c.name).textContent("Existen "+c.quantity+" Unidades actualmente en el deposito.").placeholder("Cantidad").ariaLabel("quantity").targetEvent(b).ok("Vender!").cancel("Cancelar");d.show(e).then(function(b){c.quantity-=b,c.quantity=c.quantity<0?0:c.quantity,c.put().then(function(){a.showToast("Venta exitosa! Quedan: "+c.quantity+" Unidades",c.name)})},function(){})}else d.show(d.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("No sabemos cuantas unidades hay de este producto!").textContent("Edita el producto y especifica una cantidad").ariaLabel("No quantity").ok("Gracias!").targetEvent(b))},a.deleteProduct=function(b,c){var e=d.confirm().title("Esta seguro de borrar este producto?").textContent("El producto seleccionado se borrara").ariaLabel("Delete product").targetEvent(b).ok("Borralo!").cancel("Cancelar");d.show(e).then(function(){c.remove().then(function(){_.pull(a.products,c),a.showToast(h.message006,c.name)},function(){})})},a.openAddPriceWhenNoPriceModal=function(b,c){var e={type:a.selectedPriceType};_.includes(a.selectedPriceType,"Unidad")?e.quantity=1:e.quantity=100;var f=d.prompt().title("Nuevo Precio!").textContent("Agrega el precio por "+a.selectedPriceType+" ("+e.quantity+")").placeholder("Nuevo Precio").ariaLabel("Nuevo Precio").targetEvent(b).ok("Guardar").cancel("Cancelar");d.show(f).then(function(b){e.value=b,c.prices.push(e),c.put().then(function(b){a.showToast("Agregaste un nuevo precio al producto ",b.name)})},function(){})},a.searchFavorite=function(b){a.searchTags=[],a.searchTags.push(b),a.search()},a.toggleFavorite=function(a){a.isFavorite?m(a):l(a)},a.search()}]),angular.module("tunariApp").controller("QuestionModalCtrl",["$scope","$uibModalInstance","options",function(a,b,c){a.options=c,a.accept=function(){b.close()},a.cancel=function(){b.dismiss()}}]),angular.module("tunariApp").controller("RegisterCtrl",["$scope","$location","Register",function(a,b,c){a.layout.title="Registrar Usuario",a.layout.hideHeader=!1,a.registerUser=function(){var d={name:a.name,lastName:a.lastName,userName:a.userName,password:a.password};c.post(d).then(function(a){b.path("/")})}}]),angular.module("tunariApp").controller("SamplebookCtrl",["$scope","$uibModalInstance","ServerData","product",function(a,b,c,d){a.imageUrl=c.urlImages+"/"+d.category+"/"+(d.properties.type||"")+"/"+d.name+"-L.jpg",a.dissmissModal=function(){b.dismiss()}}]),angular.module("tunariApp").controller("sellingItemCtrl",["$scope","$mdDialog","ServerData","SellingItemInfo","sellingItem",function(a,b,c,d,e){a.selling=$.extend(!0,{},e),a.selling.productPrice=_.where(a.selling.product.prices,{_id:a.selling.productPrice._id})[0],a.serverData=c,a.imageUrl=c.urlImages+"/"+a.selling.product.category+"/"+(a.selling.product.properties.type||"")+"/"+a.selling.product.name+"-M.jpg",a.updateTotal=function(){d.updateProperties(a.selling)},a.saveSelling=function(){e=a.selling,b.hide(e)},a.cancel=function(){b.cancel()}}]),angular.module("tunariApp").controller("SellingsChartsCtrl",["$scope","Sellings",function(a,b){a.getSellings=function(){b.getList({from:moment(a.from).format(a.format),to:moment(a.to).format(a.format)}).then(function(b){a.sellings=[],_.each(b,function(b){_.map(b.sellingItems,function(a){return a.client=b.client[0],a.date=b.date,a}),a.sellings=a.sellings.concat(b.sellingItems)}),a.totalSellings=_.round(_.sum(a.sellings,"total"),2)})},a.formatDate=function(a){return moment(a).format("dddd, MMMM DD YYYY")},a.formatHour=function(a){return moment(a).format("h:mm:ss a")},a.format="YYYY-MM-DD HH:mm:ss",a.from=moment({hour:0,minute:0,second:0}).format(a.format),a.to=moment({hour:23,minute:59,second:59}).format(a.format),a.getSellings()}]),angular.module("tunariApp").controller("SettingsCtrl",["$scope","$window","$location","Settings","ProductInfo",function(a,b,c,d,e){function f(a){401==a.status&&(console.log("Invalid jwt in local storage!, then redirecting to login"),c.path("/login"))}a.layout.title="Configuraciones",a.layout.hideHeader=!1,d.getList().then(function(b){a.imgServer=_.find(b,{key:"imgServer"}),a.quickSearchs=_.find(b,{key:"quickSearchs"}),a.excludeListForStatistics=_.find(b,{key:"excludeListForStatistics"}),a.invitationTypes=_.find(b,{key:"invitationTypes"}),a.imgServer||d.post({key:"imgServer",value:""}).then(function(b){a.imgServer=b}),a.invitationTypes||d.post({key:"invitationTypes",value:[]}).then(function(b){a.invitationTypes=b}),a.quickSearchs||d.post({key:"quickSearchs",value:[]}).then(function(b){a.quickSearchs=b}),a.excludeListForStatistics||d.post({key:"excludeListForStatistics",value:[]}).then(function(b){a.excludeListForStatistics=b})},f),a.testImgServer=function(){b.location.href=a.imgServer.value+"/test.html?returnUrl="+c.absUrl()},a.saveSettings=function(){a.imgServer.save().then(function(){e.setImageServer(a.imgServer.value)}),a.quickSearchs.save().then(function(){e.setProductQuickSearchs(a.quickSearchs.value)}),a.excludeListForStatistics.value=_.map(a.excludeListForStatistics.value,_.toUpper),a.excludeListForStatistics.save(),a.invitationTypes.save(),c.path("/products")}}]),angular.module("tunariApp").controller("ShopCtrl",["$scope","$mdSidenav","$mdDialog","$mdToast","$mdBottomSheet","$mdMedia","$location","$uibModal","Products","ProductInfo","ServerData","SearchInfo","SellingItemInfo","Messages","Notifier",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){_.forEach(a.products,function(a){a.quantityToSell=0})}function q(){a.shoppingCartSellings=[]}a.layout.title="Productos",a.layout.backupTitle="Productos",a.layout.bottomFabButtonIcon="shopping_cart",a.layout.bottomFabButtonIconTooltip="Ver el Carrito",a.serverData=k,a.tags=l.getTags(),a.pagination={current:1,itemsPerPage:30},a.isLoading=!0,a.search=function(b){a.isLoading=!0;var c=a.tags?{tags:a.tags}:{};c.page=b,c.queryLimit=a.pagination.itemsPerPage,i.getList(c).then(function(c){a.products=c,a.totalProducts=c.meta.count,a.pagination.current=b,l.setTags(a.tags),a.isLoading=!1})},a.pageChanged=function(b){a.search(b)},a.openQuantityModal=function(a,b){b.stopPropagation();var d=f("sm")||f("xs");c.show({controller:"AddquantityCtrl",templateUrl:"../../views/addQuantity.html",locals:{product:a},parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:d})},a.openImageModal=function(a,b){b.stopPropagation();var d=f("sm")||f("xs");c.show({controller:"ImageCtrl",templateUrl:"../../views/modal/image.html",locals:{product:a},parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:d})},a.addQuantity=function(a){a.quantityToSell++},a.stepUpQuantity=function(a,b){var c=_.ceil((a.quantityToSell+1)/25);a.quantityToSell=25*c},a.stepDownQuantity=function(a,b){var c=_.floor((a.quantityToSell-1)/25);a.quantityToSell=25*c,a.quantityToSell<0&&(a.quantityToSell=0)},a.addToCart=function(b,c){if(c.stopPropagation(),b.quantityToSell>b.quantity)return a.$parent.showToast("Solo hay "+b.quantity+" unidades en el deposito!",b.name),void(b.quantityToSell=0);var d=_.find(a.shoppingCartSellings,function(a){return a.product.name===b.name});d?d.quantity+=b.quantityToSell:(d={product:b,productPrice:b.prices[0],quantity:b.quantityToSell},a.shoppingCartSellings.push(d),a.$parent.cartItemsCount++),m.updateProperties(d),b.quantityToSell=0,a.$parent.showToast("Agregaste un producto al carrito!",b.name)},a.getProductImageUrl=function(a,b){return j.getProductImageUrl(a,b)},a.addProduct=function(a){var b=h.open({templateUrl:"../../views/addingProduct.html",controller:"AddingProductCtrl",resolve:{productName:function(){return a.name}}});b.result.then(function(b){a.quantity+=b,a.save(),o({message:n.message012+a.name+" : "+a.quantity,classes:"alert-info"})})},a.editProduct=function(a){g.path("products/"+a)},a.windowTop=function(){window.scrollTo(0,0)},a.queryProductSearchNames=function(b){if(b&&""!==b){console.log("asdfsdf");var b=b?{tags:b}:{};return b.properties="name",b.querySort="name",b.queryLimit=10,a.productSearchText=null,i.getList(b).then(function(a){var b=_.map(a,"name");return b})}return[]},a.setTags=function(b){a.tags=b},a.$on("onBottomFabRightButtonClicked",function(b,d){var e=f("sm")||f("xs");c.show({controller:"summaryCartCtrl",templateUrl:"../../views/modal/summaryCart.html",locals:{sellingItems:a.shoppingCartSellings,sellClient:a.sellClient},parent:angular.element(document.body),targetEvent:d.ev,clickOutsideToClose:!0,fullscreen:e}).then(function(b){a.shoppingCartSellings=[],a.$parent.showToast("Venta exitosa!","Total: "+b+" Bs.")},function(b){a.sellClient=b})}),a.$on("onBottomFabLeftButtonClicked",function(a,b){e.show({templateUrl:"../../views/bottomSheet/sellingOptions.html",controller:"SellingOptionsCtrl"}).then(function(a){"ResetProductQuantities"===a.name?p():"CleanShoppingCart"===a.name&&q()})}),a.$on("onFinalResultFromSpeechRecognizer",function(b,c){a.tags=c.finalSearchText,a.search(a.tags,1)}),a.shoppingCartSellings=[],a.sellClient,a.openSell=function(b,d){var e=f("sm")||f("xs");c.show({controller:"sellingItemCtrl",templateUrl:"../../views/sellingItem.html",locals:{sellingItem:{product:b.product,productPrice:b.productPrice,quantity:b.quantity,total:b.total}},parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:!0,fullscreen:e}).then(function(b){var c=_.findIndex(a.shoppingCartSellings,function(a){return a.product.name==b.product.name});a.shoppingCartSellings[c]=b},function(){a.status="You cancelled the dialog."})},a.removeSelling=function(b){_.pull(a.shoppingCartSellings,b)},a.getTotal=function(){var b=_.sum(a.shoppingCartSellings,function(a){return a.total});return _.round(b,2)},a.search(1)}]),angular.module("tunariApp").controller("StatisticsCtrl",["$scope","$mdMedia","Products","Settings","ProductInfo",function(a,b,c,d,e){a.layout.title="Estadisticas",a.layout.hideHeader=!1,a.products=[],a.productsToGraph=[],a.searchTags=[];var f=[];a.search=function(){var d=_.isEmpty(a.searchTags)?{}:{tags:a.searchTags.join(" ")};d.querySort="quantity",d.excludeProductNames=f.join(",");var e=b("xs")?5:b("sm")?8:b("md")?14:20;c.getList(d).then(function(b){a.showToast(b.meta.count+" Productos encontrados!","TUNARI"),a.products=_.map(b,function(a){return a}),a.productsToGraph=_.take(a.products,e)})},a.getProductImageUrl=function(a,b){return e.getProductImageUrl(a,b)},d.getList().then(function(b){f=_.find(b,{key:"excludeListForStatistics"}).value,a.search()})}]),angular.module("tunariApp").controller("StatisticsOptionsCtrl",["$scope","$uibModalInstance","ServerData",function(a,b,c){c.config.get().then(function(b){a.options=b.statisticsViews}),a.selectOption=function(a){b.close(a.view)}}]),angular.module("tunariApp").directive("checkImage",["$http","Config","AuthToken",function(a,b,c){return{restrict:"A",link:function(b,d,e){function f(){b.objectURL&&URL.revokeObjectURL(b.objectURL);
}b.$watch("objectURL",function(a){d.attr("src",a)}),b.$on("$destroy",function(){f()}),e.$observe("checkImage",function(e){f(),e&&0===e.indexOf("data:")?b.objectURL=e:e&&a.get(e,{responseType:"arraybuffer",headers:{accept:"image/webp,image/*,*/*;q=0.8",authorization:"Bearer "+c.getToken()}}).then(function(a){var c=new Blob([a.data],{type:a.headers("Content-Type")});b.objectURL=URL.createObjectURL(c)},function(a){404!==a.status&&d.attr("src","/images/imgServerError.gif")})})}}}]),angular.module("tunariApp").directive("preventRightClick",function(){return{restrict:"A",link:function(a,b){b.bind("contextmenu",function(a){a.preventDefault()})}}}),angular.module("tunariApp").directive("productQuantityChart",["ProductInfo",function(a){var b={top:70,right:30,bottom:100,left:90},c=c=400-b.top-b.bottom,d=10;return{restrict:"E",scope:{titleText:"=",data:"=",barsColor:"="},link:function(e,f,g){var h=$("#chart").width()-b.left-b.right;$(window).resize(function(){var a=$("#chart").width()-b.left-b.right;a>0&&h!=a&&(h=a,j(e.data))});var i=d3.select(f[0]).append("svg").attr("class","svg").attr("width",h+b.left+b.right).attr("height",c+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")");e.$watch("data",function(a,b){j(a)});var j=function(g){if(i.selectAll("*").remove(),g){var j=g.length,k=h/j,l=_.max(_.map(g,"quantity"));d3.select(f[0]).select("svg").attr("width",h+b.left+b.right),i.append("text").attr("x",60).attr("y",0-b.top/2).attr("text-anchor","middle").style("font-size","32px").style("text-decoration","underline").text(e.titleText),i.append("text").attr("transform","rotate(-90)").attr("y",-b.left).attr("x",-(c/2)).attr("dy","1em").style("font-size","15px").style("text-anchor","middle").text("Cantidad en el Depósito");var m=d3.scale.ordinal().domain(g.map(function(a){return a.name})).rangeBands([0,h]),n=d3.scale.linear().domain([0,l]).range([c,0]),o=d3.svg.axis().scale(m).orient("bottom").innerTickSize(-c).tickPadding(10),p=d3.svg.axis().scale(n).orient("left").innerTickSize(-h).tickPadding(10);i.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(o).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)"),i.append("g").attr("class","y axis").call(p),i.selectAll("text.bar").data(g).enter().append("text").attr("class","bar").attr("text-anchor","middle").attr("x",function(a){return m(a.name)+h/j/2}).attr("y",c-5).text(function(a){return a.quantity}).transition().delay(function(a,b){return 100*b}).attr("y",function(a){return n(a.quantity)-10});var q=d3.tip().attr("class","card tooltip").offset(function(a,b){return 0==b&&g.length>1?[0,0]:[0,-40]}).direction("w");q.direction(function(a,b){return 0==b&&g.length>1?"e":"w"}).html(function(b){a.getProductImageUrl(b,"-L");return"<div clas='card-content'><p class='truncate card-title grey-text text-darken-4'>"+b.name+"</p><p>"+b.quantity+" Unidades</p></div>"}),i.call(q);var r=i.selectAll("g.bar").data(g).enter().append("g").style("fill",e.barsColor).style("fill-opacity",.7).style("stroke","black").style("stroke-width",3).attr("class","bar").attr("transform",function(a,b){return"translate("+(b*k+d/2)+",0)"}).on("mouseover",q.show).on("mouseout",q.hide);r.append("rect").attr("width",k-d).attr("x",0).attr("y",c).attr("rx",5).attr("height",0).transition().delay(function(a,b){return 100*b}).attr("y",function(a){return n(a.quantity)}).attr("height",function(a){return a.quantity*c/l})}}}}}]),angular.module("tunariApp").directive("productlocation",function(){return{require:"ngModel",restrict:"EA",link:function(a,b,c,d){d.$parsers.push(function(a){var b=a,c=/^d(\w) e(\d+) p(\d+)$/,d=a.match(c);return d&&(b="Deposito "+d[1].toUpperCase()+", Estante "+d[2]+", Peldaño "+d[3]),b})}}}),angular.module("tunariApp").directive("sellingquantity",function(){return{require:"ngModel",restrict:"EA",scope:{maxQuantity:"@"},link:function(a,b,c,d){d.$parsers.push(function(b){var c=b,e=/^(\d+)[ #\*](\d+)$|(^\d+)$/,f=b.match(e);return f&&(f[1]&&f[2]?c=100*parseInt(f[1])+parseInt(f[2]):f&&f[3]&&(c=parseInt(f[3])),c>a.maxQuantity?(d.$setValidity("max_quantity",!1),c=void 0):d.$setValidity("max_quantity",!0)),c})}}}),angular.module("tunariApp").directive("sellingsBarChart",["ServerData",function(a){var b={top:20,right:20,bottom:100,left:40},c=500-b.top-b.bottom,d=5,e=d3.scale.category20(),f="dddd, MMMM DD YYYY HH:mm:ss",g="YYYY-MM";return{restrict:"E",scope:{data:"="},link:function(h,i,j){function k(g){z.selectAll("*").remove(),A.selectAll("*").remove(),d3.select(i[0]).select("svg").attr("width",t+b.left+b.right),z.append("text").attr("transform","rotate(-90)").attr("y",-b.left).attr("x",-(c/2)).attr("dy","1em").style("font-size","15px").style("text-anchor","middle").text("Total [Bs]"),l(g);var h=m(g),j=p(h),k=A.append("svg").attr("height",50*h.length).selectAll(".legend").data(q).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(5,"+37*b+")"});k.append("rect").attr("x",0).attr("width",50).attr("height",35).style("fill-opacity",.7).attr("rx",5).style("fill",function(a,b){return e(a)}),k.append("text").attr("x",51).attr("y",function(a,b){return 18+.1*b}).text(function(a){return a}),u.range([j/2,t-j/2]).domain(d3.extent(h,function(a){return s(a.roundedDate)})),v.domain([0,d3.max(h,function(a){return a.y1})]),x.innerTickSize(-t),z.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(w),z.append("g").attr("class","y axis").call(x);var n=d3.tip().attr("class","well well-lg").html(function(b){return"<div class='col-xs-12'><div class='col-xs-7'><img class='img-responsive' src='"+a.urlImages+"/"+b.product.category+"/"+(b.product.properties.type||"")+"/"+b.product.name+"-S.jpg'></img></div><div class='col-xs-5'><strong>Producto:</strong> <span>"+b.product.name+"</span></br><strong>Total:</strong> <span>"+b.total+"</span></br><strong>Fecha:</strong> <span>"+b.date.format(f)+"</span></div></div>"});z.call(n),z.append("g").attr("class","bars").selectAll(".bar.stack").data(h).enter().append("g").attr("class","bar stack").style("stroke","black").style("stroke-width",2).style("fill-opacity",.7).attr("transform",function(a){return"translate("+(u(s(a.roundedDate))-j/2+d/2)+",0)"}).on("mouseover",n.show).on("mouseout",n.hide).append("rect").attr("class","bar").attr("width",j-d).attr("y",c).attr("height",0).style("fill",function(a,b){return e(a.product.name)}).transition().delay(function(a,b){return 70}).attr("y",function(a){return v(a.y1)}).attr("height",function(a){return v(a.y0)-v(a.y1)}),z.selectAll(".axis line, .axis path").style({stroke:"Black",fill:"none","stroke-width":"0.5px"})}function l(a){var b=moment(a[0].date).diff(moment(a[a.length-1].date));b<864e5?(s=d3.time.format("%Y-%m-%d %H").parse,g="YYYY-MM-DD HH",r="hour"):b<26784e5?(s=d3.time.format("%Y-%m-%d").parse,g="YYYY-MM-DD",r="day"):(s=d3.time.format("%Y-%m").parse,g="YYYY-MM",r="month")}function m(a){var b=n(a);return q=_.uniq(_.pluck(b,"product[0].name")),b=o(b)}function n(a){var b=_.chain(a).groupBy(function(a){return a.product[0].name}).mapValues(function(a){return{total:_.sum(a,function(a){return a.total}),sellings:a}}).sortBy(function(a){return-a.total}).take(20).pluck("sellings").flatten().value();return b}function o(a){var b=_.sortBy(a,function(a){return a.date}),c=_.groupBy(b,function(a){return moment(a.date).format(g)}),d=[],e=_.keys(c);return _.each(e,function(a){var b=0,e=c[a];_.each(e,function(c){d.push({roundedDate:a,date:moment(c.date),product:c.product[0],y0:b,y1:b+=c.total,total:c.total})})}),d}function p(a){var b=a[0].date.clone().startOf(r),c=a[a.length-1].date.clone().startOf(r),d=c.diff(b,r)+1,e=t/d;return e}var q,r,s,t=$("#sellings-bar-chart").width()-b.left-b.right,u=d3.time.scale(),v=d3.scale.linear().range([c,0]),w=d3.svg.axis().scale(u).orient("bottom").innerTickSize(-c).ticks(4),x=d3.svg.axis().scale(v).orient("left"),y=d3.select(i[0]).append("svg").attr("width",t+b.left+b.right).attr("height",c+b.top+b.bottom),z=y.append("g").attr("transform","translate("+b.left+","+b.top+")"),A=d3.selectAll("#selling-legends");$(window).resize(function(){var a=$("#sellings-bar-chart").width()-b.left-b.right;a>0&&t!=a&&(t=a,k(h.data))}),h.$watch("data",function(a,b){k(a)})}}}]),angular.module("tunariApp").directive("sellingsDatepicker",function(){return{templateUrl:"../../views/sellingsDatepicker.html",restrict:"E",scope:{from:"=",to:"=",format:"="},link:function(a,b,c){a.status={from:{opened:!1},to:{opened:!1}},a.openFrom=function(b){a.status.from.opened=!0},a.openTo=function(b){a.status.to.opened=!0}}}}),angular.module("tunariApp").directive("shoppingcart",function(){var a=["$scope","Sellings","Notifier","Messages","$uibModal","ServerData",function(a,b,c,d,e,f){a.serverData=f,a.selling={sellingItems:a.sellingItems},a.getTotalRevenue=function(){var b=_.sum(a.sellingItems,function(a){return a.revenue});return _.round(b,2)},a.getTotal=function(){var b=_.sum(a.sellingItems,function(a){return a.total});return _.round(b,2)},a.showSelling=function(b){var c=e.open({templateUrl:"../../views/sellingItem.html",controller:"sellingItemCtrl",size:"lg",resolve:{sellingItem:function(){return b}}});c.result.then(function(c){var d=a.sellingItems.indexOf(b);a.sellingItems[d]=c})},a.saveSelling=function(){return $("#shoppingcartbody").collapse("hide"),a.sellingItems.length<=0?void c({message:d.message016,classes:"alert-warning"}):(a.client?a.selling.client=a.client:a.selling.client={name:"Desconocido",address:"Desconocido",phone:"9999999"},a.selling.sellingItems=a.sellingItems,a.selling.total=a.getTotal(),a.selling.revenue=a.getTotalRevenue(),_.each(a.selling.sellingItems,function(a){var b=a.product.quantity-a.quantity;a.product.quantity=b,a.product.put()}),void b.post(a.selling).then(function(){a.sellingItems=[],c({message:d.message007,classes:"alert-info"})}))},a.cleanSelling=function(){$("#shoppingcartbody").collapse("hide"),a.sellingItems=[]},$(".shopping-cart-body").css("max-height",$(window).height()/2.5)}];return{templateUrl:"../../views/shoppingcart.html",restrict:"EA",scope:{sellingItems:"="},controller:a}}),angular.module("tunariApp").directive("tagsproduct",function(){return{require:"ngModel",restrict:"EA",link:function(a,b,c,d){d.$formatters.push(function(a){var b=a;return b&&(b=a.join(" ")),b}),d.$parsers.push(function(a){var b=a;return b&&(b=a.split(" ")),b})}}}),angular.module("tunariApp").directive("typeahead",function(){var a=["$scope","Sellings","Clients",function(a,b,c){var d=new Bloodhound({datumTokenizer:function(){},queryTokenizer:Bloodhound.tokenizers.whitespace});a.exampleData={displayKey:"name",source:d.ttAdapter()},a.exampleOptions={highlight:!0},c.getList().then(function(b){d=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:b}),d.initialize(),a.exampleData={displayKey:"name",source:d.ttAdapter()}}),a.client=null}];return{template:'<input placeholder="Cliente..." class="typeahead sfTypeahead form-control" options="exampleOptions" datasets="exampleData"         ng-model="client"/>',scope:{client:"="},restrict:"EA",controller:a}}),angular.module("tunariApp").directive("uppercase",function(){return{require:"ngModel",restrict:"EA",link:function(a,b,c,d){d.$parsers.push(function(a){var b=a.toUpperCase();return b})}}}),angular.module("tunariApp").directive("validateEquals",function(){return{require:"ngModel",link:function(a,b,c,d){var e=c.ngModel,f=c.validateEquals;a.$watch("["+e+","+f+"]",function(){a[e]&&d.$setValidity("equal",a[e]===a[f])})}}}),angular.module("tunariApp").directive("validateNotEmpty",function(){return{require:["ngModel","^form"],link:function(a,b,c,d){function e(){var b=""===a[f]||void 0===a[f],c=b&&g.$touched||b&&h&&h.$submitted,d=!c;return d}self=this;var f=c.ngModel,g=d[0],h=d[1],i=function(){return h&&h.$submitted};a.$watch(f,function(){var a=e();g.$setValidity("empty",a)}),a.$watch(i,function(){var a=e();g.$setValidity("empty",a)})}}}),angular.module("tunariApp").filter("checkedProduct",function(){return function(a,b,c){var d=[];return angular.forEach(a,function(a){var e=_.some(b.productSamples,function(b){return b==a.name});"Repartidos"==c?e&&d.push(a):"No Repartidos"==c?e||d.push(a):d.push(a)}),d}}),angular.module("tunariApp").factory("AuthInterceptor",["AuthToken",function(a){var b={request:function(b,c,d,e,f,g){var h=a.getToken();return{element:b,params:g,headers:{authorization:"Bearer "+h}}},response:function(a){return a}};return b}]),angular.module("tunariApp").factory("AuthRestangular",["Restangular","AuthInterceptor",function(a,b){return a.withConfig(function(a){a.addFullRequestInterceptor(b.request)})}]),angular.module("tunariApp").factory("AuthToken",["$window",function(a){var b,c,d=a.localStorage,e="userToken",f="userFullNameKey",g={setUserToken:function(a){b=a.token,c=a.user.name+" "+a.user.lastName,d.setItem(e,b),d.setItem(f,c)},getToken:function(){return b||(b=d.getItem(e)),b},getUserFullName:function(){return c||(c=d.getItem(f)),c},removeUserToken:function(){b=null,c=null,d.removeItem(e),d.removeItem(f)},isAuthenticated:function(){return!!g.getToken()}};return g}]),angular.module("tunariApp").service("Clients",["Restangular",function(a){return a.service("clients")}]),angular.module("tunariApp").service("Login",["Restangular",function(a){return a.service("login")}]),angular.module("tunariApp").constant("Messages",{message001:"Felicidades!, Ha creado el cliente ",message002:"Felicidades!, Ha creado el producto ",message003:"Ha modificado satisfactoriamente el cliente ",message004:"Ha modificado satisfactoriamente el producto ",message005:"Ha eliminado el cliente ",message006:"El producto ha sido elminado!",message007:"Venta Exitosa!",message008:"Eliminar Cliente",message009:"Esta seguro de elminar el cliente ",message010:"Eliminar Producto",message011:"Esta seguro de elminar el producto ",message012:"Nueva cantidad del producto ",message013:"La cantidad no es correcta.",message014:"Introduzca la cantidad por favor.",message015:"Unidades.",message016:"No hay productos en el carrito!, añada uno con los botones verdes.",message017:"Ya existe un producto <%= product %> en el carrito!, por favor modifique el que ya existe",message018:"El producto <%= product %> ya existe en la base de datos, por favor utilize otro nombre",message019:"Hubo un problema con el servidor por favor contactese con su proveedor"}),angular.module("tunariApp").factory("Notifier",["notify",function(a){return a.config({duration:3e3}),a}]),angular.module("tunariApp").service("ProductInfo",["Settings","Config",function(a,b){var c="",d="",e=[],f=[],g=[];a.getList().then(function(a){c=_.find(a,{key:"imgServer"}).value,e=_.find(a,{key:"quickSearchs"}).value,d=_.find(a,{key:"priceTypes"}).value[1],f=_.find(a,{key:"excludeListForStatistics"}).value,g=_.find(a,{key:"priceTypes"}).value}),this.getProductImageUrl=function(a,b){var d="";return d=a&&a.name&&!_.isEmpty(a.category)?"Invitaciones"!==a.category||_.isEmpty(a.properties)?c+"/"+a.category+"/"+a.name+b+".jpg":c+"/"+a.category+"/"+(a.properties.type||"")+"/"+a.name+b+".jpg":"/images/tunari-logo-1.png"},this.getExtraImageUrl=function(a){return c+"/extras/"+a+".jpg"},this.setImageServer=function(a){c=a},this.setProductQuickSearchs=function(a){e=a},this.getProductQuickSearchs=function(){return e},this.getPriceTypes=function(){return g},this.setSelectedPriceType=function(a){d=a},this.getSelectedPriceType=function(){return d},this.setExcludeListForStatistics=function(){return f},this.getExcludeListForStatistics=function(){return f}}]),angular.module("tunariApp").factory("Products",["AuthRestangular",function(a){return a.service("products")}]),angular.module("tunariApp").service("Register",["AuthRestangular",function(a){return a.service("register")}]),angular.module("tunariApp").service("SearchInfo",function(){this.tags="",this.getTags=function(){return this.tags},this.setTags=function(a){this.tags=a}}),angular.module("tunariApp").service("SellingItemInfo",[function(){this.updateProperties=function(a){var b="Unidad"!=a.productPrice.type?a.productPrice.value/a.product.properties.quantityPerPackage:a.productPrice.value;a.total=a.quantity*b,a.total=parseFloat(a.total.toFixed(1)),this.updateRevenue(a)},this.updateRevenue=function(a){var b=("Unidad"!=a.productPrice.type?a.productPrice.value/a.product.properties.quantityPerPackage:a.productPrice.value,"Unidad"!=a.product.buyingPrice.type?a.product.buyingPrice.value/a.product.properties.quantityPerPackage:a.product.buyingPrice.value);a.revenue=a.total-a.quantity*b,a.revenue=parseFloat(a.revenue.toFixed(1))}}]),angular.module("tunariApp").service("Sellings",["Restangular",function(a){return a.service("sellings")}]),angular.module("tunariApp").service("ServerData",["Config","Restangular",function(a,b){this.config=b.oneUrl("config",a.tunariApi+"/api/config"),this.urlImages=a.tunariApi+"/images/"}]),angular.module("tunariApp").service("Settings",["AuthRestangular",function(a){return a.service("settings")}]),angular.module("tunariApp").factory("SpeechRecognition",["$window",function(a){function b(){angular.forEach(k,function(a){a()})}function c(a){angular.forEach(l,function(b){b(a)})}function d(){m&&(j=new m,j.maxAlternatives=3,j.interimResults=!0,j.onstart=f,j.onend=g,j.onresult=e)}function e(a){if(a.results){var d=a.results[a.resultIndex];o=d[0].transcript,b(),d.isFinal?(c(o),console.log("Final result: "+o)):console.log("Interm result: "+o)}}function f(){n=!0}function g(){n=!1}function h(){if(!j)throw new Error("Speech recognition is not supported");n||j.start()}function i(){j&&j.stop()}var j,k=[],l=[],m=a.SpeechRecognition||a.webkitSpeechRecognition,n=!1,o="",p={startRecognition:h,stopRecognition:i,getTranscript:function(){return o},registirObserverOnResultCallback:function(a){k.push(a)},registirObserverOnFinalResultCallback:function(a){l.push(a)}};return d(),p}]);